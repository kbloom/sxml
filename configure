#!/bin/sh

#Copyright (C) 2006  Sterling Stuart Stein
#
#This program is free software: you can redistribute it and/or modify
#it under the terms of the GNU Lesser General Public License as published by
#the Free Software Foundation, either version 3 of the License, or (at your
#option) any later version.
#
#This program is distributed in the hope that it will be useful,
#but WITHOUT ANY WARRANTY; without even the implied warranty of
#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the 
#GNU General Public License for more details.
#
#You should have received a copy of the GNU General Public License
#along with this program.  If not, see <http://www.gnu.org/licenses/>.


#Configure so can compile and install to proper place

#Set default values
VAL_LIBPATH=/usr/lib
VAL_BIGLOOLIBPATH=/usr/lib/bigloo/2.8b
VAL_BIGLOOVERSION=2.8b



#Read commandline parameters
while true
do
  param="$1"
  shift

  if [ "$#" -le 0 ]
  then
    break
  fi

  case "$param" in
    -h | --help )
      echo 'Parameters:
--help                    This list
--libpath <path>          Path to library
--bigloolibpath <path>    Path to Bigloo library
--biglooversion <ver>     Version of Bigloo
'
      exit
      ;;

    --libpath )
        VAL_LIBPATH="$1"
        shift
        SKIP_LIBPATH=1
      ;;

    --bigloolibpath )
        VAL_BIGLOOLIBPATH="$1"
        shift
        SKIP_BIGLOOLIBPATH=1
      ;;

    --biglooversion )
        VAL_BIGLOOVERSION="$1"
        shift
        SKIP_BIGLOOVERSION=1
      ;;

    * )
      echo "Unknown parameter '$param'"
      exit
      ;;
  esac
done



#Detect values
echo -n -e "Detecting library path...       "
echo "${VAL_LIBPATH}"

echo -n -e "Detecting Bigloo library path..."

if [ -z "${SKIP_BIGLOOLIBPATH}" ]
then
  DETECT_BIGLOOLIBPATH="`bigloo -i /dev/stdin << EOF
(print *default-lib-dir*)
(quit)
EOF`"
  if [ -n "${DETECT_BIGLOOLIBPATH}" ]
  then
    VAL_BIGLOOLIBPATH="${DETECT_BIGLOOLIBPATH}"
  fi
fi
echo "${VAL_BIGLOOLIBPATH}"

echo -n -e "Detecting Bigloo version...     "

if [ -z "${SKIP_BIGLOOVERSION}" ]
then
  DETECT_BIGLOOVERSION="`bigloo -i /dev/stdin << EOF
(print *bigloo-version*)
(quit)
EOF`"
  if [ -n "${DETECT_BIGLOOVERSION}" ]
  then
    VAL_BIGLOOVERSION="${DETECT_BIGLOOVERSION}"
  fi
fi
echo "${VAL_BIGLOOVERSION}"



#Write out values
echo "Writing Makefile.config"
echo "#Generated by configure
LIBPATH       = ${VAL_LIBPATH}
BIGLOOLIBPATH = ${VAL_BIGLOOLIBPATH}
BIGLOOVERSION = ${VAL_BIGLOOVERSION}
" > Makefile.config
